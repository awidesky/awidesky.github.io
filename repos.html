<!DOCTYPE html>
<html>
    <!--
    fabicon 추가
    -->
    <head>
        <title>awidesky.github.io</title>
        <link rel="icon" href="favicon.ico" type="image/x-icon" />
        <link href="repos.css" rel="stylesheet" />
        <script src="https://code.jquery.com/jquery-3.6.4.js"></script>
        <script src="repos.js"></script>
        <script>
            $(document).ready(function () {
                $.getJSON('https://api.github.com/users/awidesky', (user) => {
                    let r_num = user.public_repos;
                    var promises = [];
                    let i = 1;
                    while(r_num > 0) {
                        promises.push( $.getJSON('https://api.github.com/users/awidesky/repos?per_page=100&page=' + i));
                        i++;
                        r_num -= 100;
                    }
                    $.when.apply($, promises).then(function(data) {
                        data = [].concat(...data)
                        const comp = (d1, d2) => d1 < d2 ? 1 : (d1 > d2 ? -1 : 0);;
                        const not_forked = data.filter(d => !d.fork);
                        not_forked.sort(comp);
                        const forked = data.filter(d => d.fork);
                        forked.sort(comp);
                        
                        document.getElementById('loading').remove();
                        for (let i in not_forked) {
                            const repoDiv = getRepoDiv(not_forked[i]);
                            readProjectJson(not_forked[i], repoDiv);
                            document.getElementById("not_forked_repos").appendChild(repoDiv);
                        }
                        for (let i in forked) {
                            document.getElementById("forked_repos")
                                    .appendChild(getRepoDiv(forked[i]));
                        }
                    }, function(response) {
                        if(response["responseText"].includes("API rate limit")) {
                            window.location.href = 'api_limit.html';
                        } else {
                            alert(JSON.stringify(response, null, 4));
                        }
                    });
                });
            });
        </script>
    </head>
    
    <body>
        <div>
            <div style="display: inline-block"><a href="https://github.com/awidesky?tab=repositories" class="plainLink"><h1>My repositories</h1></a></div>
            <div id="loading"><h1><i>Loading...</i></h1></div>
            <div id="not_forked_repos"></div>
            <hr>
            <h2>Forked repositories</h2>
            <div id="forked_repos"></div>
        </div>
    </body>
    
</html>
